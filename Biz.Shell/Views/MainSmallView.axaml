<views:FormFactorAwareUserControl
    x:Class="Biz.Shell.Views.MainSmallView"
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:Biz.Shell.Converters;assembly=Biz.Shell"
    xmlns:core="clr-namespace:Biz.Shell;assembly=Biz.Shell"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:infrastructure="clr-namespace:Biz.Shell.Infrastructure"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:regions="http://prismlibrary.com/"
    xmlns:shadUi="clr-namespace:ShadUI;assembly=ShadUI"
    xmlns:toolbar="clr-namespace:Biz.Shell.ViewModels.Toolbar;assembly=Biz.Shell"
    xmlns:views="clr-namespace:Biz.Shell.Views;assembly=Biz.Shell"
    xmlns:vm="clr-namespace:Biz.Shell.ViewModels;assembly=Biz.Shell"
    x:Name="Root"
    d:DesignHeight="450"
    d:DesignWidth="800"
    x:CompileBindings="True"
    x:DataType="vm:MainSmallViewModel"
    x:TypeArguments="vm:MainSmallViewModel"
    mc:Ignorable="d">
    <Grid
        Background="{DynamicResource MainBackgroundColor}"
        ColumnDefinitions="Auto,*,Auto"
        RowDefinitions="Auto,*">

        <!--  Hamburger button  -->
        <Button
            x:Name="HamburgerButton"
            Width="64"
            Height="64"
            Margin="0,0,10,0"
            Padding="12"
            Background="{DynamicResource HamburgerToggleBackgroundColor}"
            Command="{Binding ToggleIsDrawerOpenCommand}"
            CornerRadius="0"
            Focusable="False">
            <PathIcon Data="{Binding IsDrawerOpen, Converter={x:Static converters:BooleanConverters.SidebarToggleIcon}}" />
        </Button>

        <!--  Header  -->
        <TextBlock
            Grid.Row="0"
            Grid.Column="1"
            Margin="0,3,0,0"
            VerticalAlignment="Center"
            Classes="Header"
            IsVisible="{Binding CurrentPage.Title,
                                Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
            Text="{Binding CurrentPage.Title}" />

        <!--  Toolbar Buttons  -->
        <ItemsControl
            Grid.Row="0"
            Grid.Column="2"
            Margin="0,0,8,0"
            BorderThickness="0"
            Focusable="False"
            ItemsSource="{Binding CurrentPage.ToolbarEntries}"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            ScrollViewer.VerticalScrollBarVisibility="Auto">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Horizontal" Spacing="8" />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.DataTemplates>
                <DataTemplate DataType="toolbar:ToolbarEntry">
                    <Button
                        Padding="3"
                        BorderThickness="0"
                        Command="{Binding Command}"
                        CornerRadius="0"
                        Focusable="False"
                        IsVisible="{Binding IsVisible}">
                        <Viewbox Width="24">
                            <PathIcon
                                VerticalAlignment="Center"
                                Data="{Binding Geometry}"
                                IsVisible="{Binding Geometry,
                                                    Converter={x:Static converters:ObjectConverters.NonNullToTrue}}" />
                        </Viewbox>
                    </Button>
                </DataTemplate>
                <DataTemplate DataType="toolbar:ToolbarSeparator" />
            </ItemsControl.DataTemplates>
        </ItemsControl>

        <!--  Everything below the toolbar  -->
        <SplitView
            x:Name="MainSplitView"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            DisplayMode="Overlay"
            IsPaneOpen="{Binding IsDrawerOpen}">
            <SplitView.Pane>
                <!--  Sidebar  -->
                <Panel>
                    <Grid RowDefinitions="*,Auto">
                        <ItemsControl
                            x:Name="Menu"
                            Background="{DynamicResource SidebarBackgroundColorMobile}"
                            BorderThickness="0"
                            Focusable="False"
                            ItemsSource="{Binding SidebarItems}"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Auto"
                            Tag="{Binding CurrentArea}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate DataType="vm:SidebarItemViewModel">
                                    <Button
                                        Margin="5,10,5,0"
                                        Padding="2,15"
                                        HorizontalContentAlignment="Left"
                                        VerticalContentAlignment="Center"
                                        Background="{Binding #Menu.Tag,
                                                             Converter={x:Static converters:CustomConverters.ToSelectionBackgroundBrush},
                                                             ConverterParameter='{Binding CommandParameter}'}"
                                        BorderThickness="0"
                                        Command="{Binding Command}"
                                        IsVisible="{Binding #Root.ViewModel.IsLoggedIn}">
                                        <StackPanel Orientation="Horizontal">
                                            <PathIcon VerticalAlignment="Center" Data="{Binding GeometryStyleResourceName, Converter={x:Static converters:StringConverters.AppStyleResource}, ConverterParameter='{Binding GeometryStyleResourceName}'}" />
                                            <TextBlock
                                                Margin="10,0,0,0"
                                                VerticalAlignment="Center"
                                                Text="{Binding DisplayName}" />
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <StackPanel Grid.Row="1">
                            <!--  Settings  -->
                            <Button
                                Margin="5,10,5,0"
                                Padding="2,15"
                                HorizontalContentAlignment="Left"
                                VerticalContentAlignment="Center"
                                Background="{Binding #Menu.Tag,
                                                     Converter={x:Static converters:CustomConverters.ToSelectionBackgroundBrush},
                                                     ConverterParameter='SettingsView'}"
                                BorderThickness="0"
                                Command="{Binding NavigateSettingsCommand}"
                                IsVisible="{Binding #Root.ViewModel.IsLoggedIn}">
                                <StackPanel Orientation="Horizontal">
                                    <PathIcon VerticalAlignment="Center" Data="{StaticResource gear}" />
                                    <TextBlock
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="Settings" />
                                </StackPanel>
                            </Button>

                            <!--  Logout  -->
                            <Button
                                Margin="5,10,5,0"
                                Padding="2,15"
                                HorizontalContentAlignment="Left"
                                VerticalContentAlignment="Center"
                                Background="Transparent"
                                BorderThickness="0"
                                Command="{Binding LogoutCommand}"
                                IsVisible="{Binding #Root.ViewModel.IsLoggedIn,
                                                    Converter='{x:Static converters:BooleanConverters.Reverse}'}">
                                <StackPanel Orientation="Horizontal">
                                    <PathIcon VerticalAlignment="Center" Data="{StaticResource leave}" />
                                    <TextBlock
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        Text="Sign Out" />
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Panel>
            </SplitView.Pane>

            <SplitView.Content>
                <!--  Main content area  -->
                <TransitioningContentControl Grid.Row="1" regions:RegionManager.RegionName="{x:Static infrastructure:RegionNames.MainContentRegion}">
                    <TransitioningContentControl.PageTransition>
                        <PageSlide Duration="0:00:00.2">
                            <PageSlide.SlideInEasing>
                                <shadUi:EaseInOutBack BounceIntensity="Soft" />
                            </PageSlide.SlideInEasing>
                        </PageSlide>
                    </TransitioningContentControl.PageTransition>
                </TransitioningContentControl>
            </SplitView.Content>
        </SplitView>
    </Grid>
</views:FormFactorAwareUserControl>